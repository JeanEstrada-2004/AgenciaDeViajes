@model List<AgenciaDeViajes.Models.Reserva>
@{
    ViewBag.Title = "Mis Reservas";
    Layout = "~/Views/Shared/_LayoutUsuario.cshtml";
    ViewBag.Active = "MisReservas";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <h2 class="fw-bold mb-3"><i class="bi bi-calendar-check"></i> Mis reservas</h2>
            <p class="text-muted">Consulta y gestiona tus reservas pasadas y próximas.</p>
        </div>
    </div>
    <div class="card shadow-sm border-0">
        <div class="card-body">
            <table class="table align-middle table-striped">
                <thead>
                    <tr>
                        <th>Destino</th>
                        <th>Fecha</th>
                        <th>Pasajeros</th>
                        <th>Pasajeros Detalle</th>
                        <th>Servicios Adicionales</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                @if (Model != null && Model.Any())
                {
                    foreach (var reserva in Model)
                    {
                        <tr>
                            <td>@(reserva.Destino?.nom_destino ?? "Destino desconocido")</td>
                            <td>@reserva.FechaTour.ToString("dd/MM/yyyy")</td>
                            <td>
                                @reserva.CantidadAdultos adulto(s)
                                @if(reserva.CantidadNinos > 0) { <text>, @reserva.CantidadNinos niño(s)</text> }
                            </td>
                            <td>
                                @if (reserva.PasajerosReserva != null && reserva.PasajerosReserva.Any())
                                {
                                    foreach (var p in reserva.PasajerosReserva)
                                    {
                                        <div class="mb-2" style="padding-left: 8px; border-left: 3px solid #6c63ff;">
                                            <span class="fw-bold">@p.NombreCompleto</span>
                                            <span class="text-muted">(@p.Tipo)</span><br />
                                            <span><strong>DNI:</strong> @p.Documento</span><br />
                                            <span><strong>Teléfono:</strong> @p.Telefono</span><br />
                                            <span><strong>País:</strong> @p.Pais</span>
                                        </div>
                                    }
                                }
                                else
                                {
                                    <span class="text-muted">Sin pasajeros registrados</span>
                                }
                            </td>
                            <td>
                                @if (reserva.ReservaServiciosAdicionales != null && reserva.ReservaServiciosAdicionales.Any())
                                {
                                    <ul class="mb-0">
                                        @foreach (var s in reserva.ReservaServiciosAdicionales)
                                        {
                                            <li>@s.Servicio</li>
                                        }
                                    </ul>
                                }
                                else
                                {
                                    <span class="text-muted">Ninguno</span>
                                }
                            </td>
                            <td>
                                @if (reserva.Estado == "Confirmada")
                                {
                                    <span class="badge bg-success">Confirmada</span>
                                }
                                else if (reserva.Estado == "Pendiente")
                                {
                                    <span class="badge bg-warning text-dark">Pendiente</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary">@reserva.Estado</span>
                                }
                            </td>
                            <td>
                                <a href="#" class="btn btn-sm btn-outline-primary"><i class="bi bi-eye"></i> Ver</a>
                                @if (reserva.Estado == "Pendiente")
                                {
                                    <a href="#" class="btn btn-sm btn-outline-danger"><i class="bi bi-x-circle"></i> Cancelar</a>
                                }
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="7" class="text-center text-muted">No tienes reservas registradas.</td>
                    </tr>
                }
                </tbody>
            </table>
        </div>
    </div>
</div>
